<%#
kind: job_template
name: Run upgrade via Leapp
job_category: Leapp - Upgrade
description_format: 'Upgrade RHEL host'
provider_type: Ansible
feature: leapp_upgrade
model: JobTemplate
template_inputs:
- name: Channel
  description: "Set if the target OS is required to use the General Availability (GA) channel - the default - or a specific channel among: Update Services for SAP Solutions (E4S), Extended Upgrade Support (EUS) or Advanced Update Support (AUS)."
  input_type: user
  required: true
  default: "ga"
  options: "ga\ne4s\neus\naus"
- name: Reboot
  description: Reboot the host automaticaly to continue with the upgrade
  input_type: user
  required: true
  default: "true"
  options: "true\nfalse"
- name: Target Version
  description: "Specify the target release version of the operating system to upgrade to. By default, the latest release is used."
  input_type: user
  required: false
%>
---
<%
  options = []
  options << ['channel', input('Channel')] if input('Channel') != 'ga'
  options << ['target', input('Target Version')] if input('Target Version').present?
  options_string = options.map { |k, v| "--#{k}=#{shell_escape(v)}"}.join(' ')
%>
- hosts: all
  tasks:
    - name: Run Leapp Upgrade
      command: leapp upgrade <%= options_string %>

<%- if input('Reboot') == "true" -%>
    - name: Reboot the machine
      reboot:
        reboot_timeout: 1800
<%- end -%>
