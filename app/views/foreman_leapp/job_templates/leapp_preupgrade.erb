<%#
kind: job_template
name: Run preupgrade via Leapp
job_category: Leapp - Preupgrade
description_format: 'Upgradeability check for RHEL host'
provider_type: SSH
feature: leapp_preupgrade
model: JobTemplate
template_inputs:
- name: Channel
  description: "Set if the target OS is required to use the General Availability (GA) channel - the default - or a specific channel among: Update Services for SAP Solutions (E4S), Extended Upgrade Support (EUS) or Advanced Update Support (AUS)."
  input_type: user
  required: true
  default: "ga"
  options: "ga\ne4s\neus\naus"
- name: Target Version
  description: "Specify the target release version of the operating system to upgrade to. By default, the latest release is used."
  input_type: user
  required: false
%>
<%
  options = []
  options << ['channel', input('Channel')] if input('Channel') != 'ga'
  options << ['target', input('Target Version')] if input('Target Version').present?
  options_string = options.map { |k, v| "--#{k}=#{shell_escape(v)}"}.join(' ')
%>

<%= render_template 'Check Leapp' %>

rm -f /var/log/leapp/leapp-report.json
leapp preupgrade <%= options_string %>

echo "===leap_upgrade_report_start==="
cat /var/log/leapp/leapp-report.json
